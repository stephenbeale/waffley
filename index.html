<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waffley - Learn Colour Words</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="language-screen" class="active">
    <h1>Waffley</h1>
    <p class="instructions">
        Learn words in a new language!<br><br>
        Pick a topic and match each <strong>image or colour</strong> to the <strong>correct word</strong> in your chosen language.
    </p>

    <div class="setting-label">I want to learn</div>
    <div class="language-selector">
        <button class="language-btn" data-lang="es">ğŸ‡ªğŸ‡¸ Spanish</button>
        <button class="language-btn" data-lang="fr">ğŸ‡«ğŸ‡· French</button>
        <button class="language-btn" data-lang="de">ğŸ‡©ğŸ‡ª German</button>
        <button class="language-btn" data-lang="it">ğŸ‡®ğŸ‡¹ Italian</button>
        <button class="language-btn" data-lang="cy">ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿ Welsh</button>
        <button class="language-btn" data-lang="pt">ğŸ‡µğŸ‡¹ Portuguese</button>
    </div>

    <div class="audio-toggle-container">
        <label class="audio-toggle">
            <input type="checkbox" id="audio-toggle-input">
            <span class="audio-toggle-slider"></span>
            <span class="audio-toggle-icon">ğŸ”Š</span>
            <span class="audio-toggle-label">Play pronunciation</span>
        </label>
    </div>

    <button id="stats-btn">Statistics</button>
</div>

<div id="topic-screen">
    <div class="topic-header" id="topic-header">ğŸ‡ªğŸ‡¸ Spanish</div>

    <div class="mode-selector" id="mode-selector">
        <button class="mode-btn selected" data-mode="words">ğŸ“ Words</button>
        <button class="mode-btn" data-mode="verbs">ğŸ”„ Verbs</button>
    </div>

    <div class="setting-label" id="words-setting-label">Category</div>
    <div class="category-selector" id="words-selector">
        <button class="category-btn selected" data-category="colours">ğŸ¨ Colours</button>
        <button class="category-btn" data-category="adjectives">ğŸ˜Š Adjectives</button>
        <button class="category-btn" data-category="animals">ğŸ¾ Animals</button>
        <button class="category-btn" data-category="food">ğŸ Food</button>
        <button class="category-btn" data-category="weather">â˜€ï¸ Weather</button>
    </div>

    <div class="setting-label" id="verb-setting-label" style="display:none">Tense</div>
    <div class="category-selector" id="verb-selector" style="display:none">
        <button class="category-btn selected" data-category="verbs_present">ğŸ• Present Tense</button>
    </div>

    <div class="progress-display" id="progress-display">
        <div class="progress-title">Your Journey</div>
        <div class="journey-tracker" id="journey-tracker">
            <div class="journey-phase" data-phase="0" role="button" tabindex="0">
                <div class="journey-dot"></div>
                <div class="journey-phase-info">
                    <div class="journey-phase-name">Learning</div>
                    <div class="journey-phase-desc">Words shown with answers</div>
                    <div class="journey-phase-progress"></div>
                </div>
            </div>
            <div class="journey-connector"></div>
            <div class="journey-phase" data-phase="1" role="button" tabindex="0">
                <div class="journey-dot"></div>
                <div class="journey-phase-info">
                    <div class="journey-phase-name">Practice</div>
                    <div class="journey-phase-desc">Answer from memory</div>
                    <div class="journey-phase-progress"></div>
                </div>
            </div>
            <div class="journey-connector"></div>
            <div class="journey-phase" data-phase="2" role="button" tabindex="0">
                <div class="journey-dot"></div>
                <div class="journey-phase-info">
                    <div class="journey-phase-name">Typing</div>
                    <div class="journey-phase-desc">Type the answer</div>
                    <div class="journey-phase-progress"></div>
                </div>
            </div>
            <div class="journey-connector"></div>
            <div class="journey-phase" data-phase="3" role="button" tabindex="0">
                <div class="journey-dot"></div>
                <div class="journey-phase-info">
                    <div class="journey-phase-name">Speech</div>
                    <div class="journey-phase-desc">Speak the answer</div>
                    <div class="journey-phase-progress"></div>
                </div>
            </div>
        </div>
        <div class="journey-stats">
            <span>Cycle <span id="start-cycle">1</span></span>
            <span class="journey-stats-sep">&middot;</span>
            <span><span id="start-total-answers">0</span> answers</span>
            <span class="journey-stats-sep">&middot;</span>
            <span>Time: <span id="start-time-limit">10</span>s</span>
        </div>
    </div>

    <div class="start-buttons">
        <button id="start-btn" class="btn btn--primary">Start Learning</button>
    </div>
    <button class="btn btn--secondary back-btn" id="back-btn">Back</button>
</div>

<div id="stats-overlay" class="overlay" role="dialog" aria-label="Statistics">
    <div class="stats-title">Your Statistics</div>
    <div class="stats-grid">
        <div class="stats-card">
            <div class="stats-card-value" id="stats-total-correct">0</div>
            <div class="stats-card-label">Total Correct</div>
        </div>
        <div class="stats-card">
            <div class="stats-card-value" id="stats-highest-cycle">1</div>
            <div class="stats-card-label">Highest Cycle</div>
        </div>
        <div class="stats-card">
            <div class="stats-card-value" id="stats-best-streak">0</div>
            <div class="stats-card-label">Best Streak</div>
        </div>
        <div class="stats-card">
            <div class="stats-card-value" id="stats-games-played">0</div>
            <div class="stats-card-label">Games Played</div>
        </div>
    </div>
    <div class="language-stats">
        <div class="language-stats-title">By Language</div>
        <div id="language-stats-list"></div>
    </div>
    <div class="stats-buttons">
        <button id="close-stats-btn">Close</button>
        <button id="reset-stats-btn">Reset Stats</button>
        <button id="reset-progress-btn">Reset Progress</button>
    </div>
</div>

<div id="game-screen">
    <div class="game-controls">
        <button class="game-control-btn" id="pause-btn" title="Pause" aria-label="Pause game">â¸</button>
        <button class="game-control-btn" id="quit-btn" title="Quit" aria-label="Quit game">âœ•</button>
    </div>
    <div class="vertical-progress-container" id="vertical-progress-container" role="progressbar" aria-valuemin="0" aria-valuemax="0" aria-valuenow="0" aria-label="Mastery progress">
        <button class="sfx-mute-btn" id="sfx-mute-btn" title="Mute sound effects" aria-label="Mute sound effects">ğŸ””</button>
        <div class="vertical-progress-bar" id="vertical-progress-bar"></div>
        <div class="vertical-progress-label" id="vertical-progress-label">0/0</div>
    </div>
    <div class="level-display">
        <div class="phase-badge learning" id="phase-badge">Learning</div>
        <div class="level-info">Level <span id="current-level">1</span></div>
        <div class="time-display">Time: <span id="time-display">10</span>s</div>
    </div>
    <div class="score-display"><span class="game-language-flag" id="game-language-flag">ğŸ‡ªğŸ‡¸</span> Score: <span id="current-score">0</span></div>
    <div class="prompt-label" id="prompt-label">What colour is this?</div>
    <div class="color-display" id="color-display" aria-label="Identify this item" role="img"></div>
    <div class="reinforcement-label" id="reinforcement-label"></div>
    <div class="speech-ui" id="speech-ui">
        <div class="mic-indicator">
            <div class="mic-icon" id="mic-icon"></div>
            <span id="mic-status">Listening...</span>
        </div>
        <div class="voice-feedback" id="voice-feedback"></div>
        <div class="speech-attempts" id="speech-attempts"></div>
    </div>
    <div class="speech-warning" id="speech-warning">
        Voice input requires a browser with Web Speech API support (Chrome, Edge) and microphone permission.
        Falling back to Practice Mode buttons.
    </div>
    <div class="typing-ui" id="typing-ui">
        <div class="accent-buttons" id="accent-buttons"></div>
        <input type="text" id="typing-input" class="typing-input"
               autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
               aria-label="Type your answer">
        <div class="typing-hint" id="typing-hint">Tip: hold a key on your keyboard for accents</div>
        <div class="typing-feedback" id="typing-feedback"></div>
    </div>
    <div id="timer-bar-container" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="100" aria-label="Time remaining">
        <div id="timer-bar"></div>
    </div>
    <div class="buttons" id="buttons-container"></div>
</div>

<div id="pause-overlay" class="overlay" role="dialog" aria-label="Game paused">
    <div class="pause-title">Paused</div>
    <div class="pause-buttons">
        <button id="resume-btn" class="btn btn--primary">Resume</button>
        <button id="quit-from-pause-btn" class="btn btn--secondary">Go to Menu</button>
    </div>
</div>

<div id="level-up-overlay" class="overlay" role="dialog" aria-label="Level up">
    <div class="level-up-title" id="level-up-title">Level Up!</div>
    <div class="level-up-streak" id="level-up-streak"></div>
    <div class="level-up-message" id="level-up-message">You reached Level 2</div>
    <div id="level-up-phase-badge" class="phase-badge" style="display:none;"></div>
    <div class="level-up-phase" id="level-up-phase"></div>
    <div class="level-up-info" id="level-up-info"></div>
    <div class="level-up-time" id="level-up-time"></div>
    <div class="level-up-countdown" id="level-up-countdown">3</div>
    <div class="overlay-nav">
        <button class="btn btn--secondary" id="level-up-menu-btn">Go to Menu</button>
    </div>
</div>

<div id="cycle-complete-overlay" class="overlay" role="dialog" aria-label="Cycle complete">
    <div class="cycle-complete-title">Cycle Complete!</div>
    <div class="cycle-complete-message" id="cycle-complete-message">You finished Cycle 1!</div>
    <div class="cycle-complete-colors" id="cycle-complete-colors">New colours unlocked!</div>
    <div class="new-color-badges" id="new-color-badges"></div>
    <div class="cycle-complete-info">Time resets to 10 seconds</div>
    <div class="cycle-complete-countdown" id="cycle-complete-countdown">5</div>
    <div class="overlay-nav">
        <button class="btn btn--secondary" id="cycle-complete-menu-btn">Go to Menu</button>
    </div>
</div>

<div id="speed-mercy-overlay" class="overlay" role="dialog" aria-label="Speed round">
    <div class="speed-mercy-title">Speed Round!</div>
    <div class="speed-mercy-message" id="speed-mercy-message">That 2-second timer is no joke!</div>
    <div class="speed-mercy-streak" id="speed-mercy-streak">Current streak: 0</div>
    <div class="speed-mercy-buttons">
        <button id="speed-mercy-retry" class="btn btn--primary">Try Again</button>
        <button id="speed-mercy-add-time">Add 2 Seconds</button>
        <button id="speed-mercy-end" class="btn btn--secondary">End Game</button>
    </div>
</div>

<div id="pronoun-intro-overlay" class="overlay" role="dialog" aria-label="Pronoun introduction">
    <div class="pronoun-intro-title" id="pronoun-intro-title">Pronouns</div>
    <div class="pronoun-intro-subtitle" id="pronoun-intro-subtitle">Learn these before you start</div>
    <table class="pronoun-table" id="pronoun-table" aria-label="Pronoun reference table"></table>
    <button id="pronoun-intro-btn" class="btn btn--primary">Let's start!</button>
</div>

<div id="end-screen">
    <h1>Well Done!</h1>
    <div id="end-message"></div>
    <div id="final-score">0</div>
    <div class="prompt-label">correct answers</div>
    <div class="personal-best" id="personal-best">New Personal Best!</div>
    <div class="best-streak-display" id="best-streak-display"></div>
    <div class="stats-row">
        <div class="stat-item">
            <div class="stat-value" id="accuracy-stat">0%</div>
            <div class="stat-label">accuracy</div>
        </div>
        <div class="stat-item">
            <div class="stat-value" id="avg-time-stat">0.0s</div>
            <div class="stat-label">avg time</div>
        </div>
    </div>
    <br><br>
    <button id="restart-btn" class="btn btn--primary">Continue</button>
</div>

<script>
  window.SUPABASE_URL      = 'https://yqgrmpewmrmcajbdjaem.supabase.co';
  window.SUPABASE_ANON_KEY = 'sb_publishable_PQl5YT_ym_Z5XUgIquYfrA__Gvm7L29';
</script>
<script type="module" src="app.js"></script>

</body>
</html>
