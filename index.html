<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waffley - Learn Colour Words</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#e94560">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Waffley">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ§‡</text></svg>">
</head>
<body>

<div id="language-screen" class="active">
    <h1>Waffley</h1>
    <p class="instructions">
        Learn words in a new language!<br><br>
        Pick a topic and match each <strong>image or colour</strong> to the <strong>correct word</strong> in your chosen language.
    </p>

    <div class="setting-label">I want to learn</div>
    <div class="language-selector">
        <button class="language-btn" data-lang="es">ğŸ‡ªğŸ‡¸ Spanish</button>
        <button class="language-btn" data-lang="fr">ğŸ‡«ğŸ‡· French</button>
        <button class="language-btn" data-lang="de">ğŸ‡©ğŸ‡ª German</button>
        <button class="language-btn" data-lang="it">ğŸ‡®ğŸ‡¹ Italian</button>
        <button class="language-btn" data-lang="cy">ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿ Welsh</button>
        <button class="language-btn" data-lang="pt">ğŸ‡µğŸ‡¹ Portuguese</button>
    </div>

    <div class="audio-toggle-container">
        <label class="audio-toggle">
            <input type="checkbox" id="audio-toggle-input">
            <span class="audio-toggle-slider"></span>
            <span class="audio-toggle-icon">ğŸ”Š</span>
            <span class="audio-toggle-label">Play pronunciation</span>
        </label>
    </div>

    <button id="stats-btn">Statistics</button>

    <div class="auth-section" id="auth-section">
        <div id="auth-signed-out">
            <p class="auth-prompt">Sign in to sync progress across devices</p>
            <div class="auth-buttons">
                <button id="google-signin-btn" class="auth-btn auth-btn--google">
                    <svg class="auth-btn-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                    Sign in with Google
                </button>
                <button id="apple-signin-btn" class="auth-btn auth-btn--apple">
                    <svg class="auth-btn-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.7 9.05 7.4c1.32.07 2.24.74 3.01.8.82-.16 1.6-.84 2.97-.9 1.7-.08 2.98.68 3.8 1.86-3.4 2-2.85 6.43.58 7.67-.7 1.57-1.64 3.17-2.36 3.45zM12.03 7.25c-.16-2.52 1.98-4.64 4.41-4.86.33 2.9-2.6 5.08-4.41 4.86z" fill="currentColor"/></svg>
                    Sign in with Apple
                </button>
            </div>
        </div>
        <div id="auth-error" class="auth-error" style="display:none"></div>
        <div id="auth-signed-in" style="display:none">
            <span class="auth-user-label" id="auth-user-label"></span>
            <button id="signout-btn" class="auth-signout-btn">Sign out</button>
        </div>
    </div>
</div>

<div id="topic-screen">
    <div class="topic-header" id="topic-header">ğŸ‡ªğŸ‡¸ Spanish</div>

    <div class="mode-selector" id="mode-selector">
        <button class="mode-btn selected" data-mode="words">ğŸ“ Words</button>
        <button class="mode-btn" data-mode="verbs">ğŸ”„ Verbs</button>
    </div>

    <div class="setting-label" id="words-setting-label">Category</div>
    <div class="category-selector" id="words-selector">
        <button class="category-btn selected" data-category="colours">ğŸ¨ Colours</button>
        <button class="category-btn" data-category="adjectives">ğŸ˜Š Adjectives</button>
        <button class="category-btn" data-category="animals">ğŸ¾ Animals</button>
        <button class="category-btn" data-category="food">ğŸ Food</button>
        <button class="category-btn" data-category="weather">â˜€ï¸ Weather</button>
    </div>

    <div class="setting-label" id="verb-setting-label" style="display:none">Tense</div>
    <div class="category-selector" id="verb-selector" style="display:none">
        <button class="category-btn selected" data-category="verbs_present">ğŸ• Present Tense</button>
        <button class="category-btn" data-category="verbs_pronouns">ğŸ‘¤ Pronouns</button>
    </div>

    <div class="progress-display" id="progress-display">
        <div class="progress-title">Your Journey</div>
        <div class="journey-tracker" id="journey-tracker">
            <div class="journey-phase" data-phase="0" role="button" tabindex="0">
                <div class="journey-dot"></div>
                <div class="journey-phase-info">
                    <div class="journey-phase-name">Learning</div>
                    <div class="journey-phase-desc">Words shown with answers</div>
                    <div class="journey-phase-progress"></div>
                </div>
            </div>
            <div class="journey-connector"></div>
            <div class="journey-phase" data-phase="1" role="button" tabindex="0">
                <div class="journey-dot"></div>
                <div class="journey-phase-info">
                    <div class="journey-phase-name">Practice</div>
                    <div class="journey-phase-desc">Answer from memory</div>
                    <div class="journey-phase-progress"></div>
                </div>
            </div>
            <div class="journey-connector"></div>
            <div class="journey-phase" data-phase="2" role="button" tabindex="0">
                <div class="journey-dot"></div>
                <div class="journey-phase-info">
                    <div class="journey-phase-name">Typing</div>
                    <div class="journey-phase-desc">Type the answer</div>
                    <div class="journey-phase-progress"></div>
                </div>
            </div>
            <div class="journey-connector"></div>
            <div class="journey-phase" data-phase="3" role="button" tabindex="0">
                <div class="journey-dot"></div>
                <div class="journey-phase-info">
                    <div class="journey-phase-name">Speech</div>
                    <div class="journey-phase-desc">Speak the answer</div>
                    <div class="journey-phase-progress"></div>
                </div>
            </div>
        </div>
        <div class="journey-stats">
            <span>Cycle <span id="start-cycle">1</span></span>
            <span class="journey-stats-sep">&middot;</span>
            <span><span id="start-total-answers">0</span> answers</span>
            <span class="journey-stats-sep">&middot;</span>
            <span>Time: <span id="start-time-limit">10</span>s</span>
        </div>
    </div>

    <div class="streak-badge" id="streak-badge">Start your streak today!</div>

    <div class="start-buttons">
        <button id="start-btn" class="btn btn--primary">Start Learning</button>
    </div>
    <button class="btn btn--secondary back-btn" id="back-btn">Back</button>
</div>

<div id="stats-overlay" class="overlay" role="dialog" aria-label="Statistics">
    <div class="stats-title">Your Statistics</div>
    <div class="stats-grid">
        <div class="stats-card">
            <div class="stats-card-value" id="stats-total-correct">0</div>
            <div class="stats-card-label">Total Correct</div>
        </div>
        <div class="stats-card">
            <div class="stats-card-value" id="stats-highest-cycle">1</div>
            <div class="stats-card-label">Highest Cycle</div>
        </div>
        <div class="stats-card">
            <div class="stats-card-value" id="stats-best-streak">0</div>
            <div class="stats-card-label">Best Streak</div>
        </div>
        <div class="stats-card">
            <div class="stats-card-value" id="stats-games-played">0</div>
            <div class="stats-card-label">Games Played</div>
        </div>
        <div class="stats-card">
            <div class="stats-card-value" id="stats-daily-streak">0</div>
            <div class="stats-card-label">Day Streak</div>
        </div>
        <div class="stats-card">
            <div class="stats-card-value" id="stats-best-daily">0</div>
            <div class="stats-card-label">Best Streak</div>
        </div>
    </div>
    <div class="language-stats">
        <div class="language-stats-title">By Language</div>
        <div id="language-stats-list"></div>
    </div>
    <div class="stats-buttons">
        <button id="close-stats-btn">Close</button>
        <button id="reset-stats-btn">Reset Stats</button>
        <button id="reset-progress-btn">Reset Progress</button>
    </div>
</div>

<div id="game-screen">
    <div class="game-controls">
        <button class="game-control-btn" id="pause-btn" title="Pause" aria-label="Pause game">â¸</button>
        <button class="game-control-btn" id="quit-btn" title="Quit" aria-label="Quit game">âœ•</button>
    </div>
    <div class="vertical-progress-container" id="vertical-progress-container" role="progressbar" aria-valuemin="0" aria-valuemax="0" aria-valuenow="0" aria-label="Mastery progress">
        <button class="sfx-mute-btn" id="sfx-mute-btn" title="Mute sound effects" aria-label="Mute sound effects">ğŸ””</button>
        <div class="vertical-progress-bar" id="vertical-progress-bar"></div>
        <div class="vertical-progress-label" id="vertical-progress-label">0/0</div>
    </div>
    <div class="level-display">
        <div class="phase-badge learning" id="phase-badge">Learning</div>
        <div class="level-info">Level <span id="current-level">1</span></div>
        <div class="time-display">Time: <span id="time-display">10</span>s</div>
    </div>
    <div class="score-display"><span class="game-language-flag" id="game-language-flag">ğŸ‡ªğŸ‡¸</span> Score: <span id="current-score">0</span></div>
    <div class="prompt-label" id="prompt-label">What colour is this?</div>
    <div class="color-display" id="color-display" aria-label="Identify this item" role="img"></div>
    <div class="reinforcement-label" id="reinforcement-label"></div>
    <div class="speech-ui" id="speech-ui">
        <div class="mic-indicator">
            <div class="mic-icon" id="mic-icon"></div>
            <span id="mic-status">Listening...</span>
        </div>
        <div class="voice-feedback" id="voice-feedback"></div>
        <div class="speech-attempts" id="speech-attempts"></div>
    </div>
    <div class="speech-warning" id="speech-warning">
        Voice input requires a browser with Web Speech API support (Chrome, Edge) and microphone permission.
        Falling back to Practice Mode buttons.
    </div>
    <div class="typing-ui" id="typing-ui">
        <div class="accent-buttons" id="accent-buttons"></div>
        <input type="text" id="typing-input" class="typing-input"
               autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
               aria-label="Type your answer">
        <div class="typing-hint" id="typing-hint">Tip: hold a key on your keyboard for accents</div>
        <div class="typing-feedback" id="typing-feedback"></div>
    </div>
    <div id="timer-bar-container" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="100" aria-label="Time remaining">
        <div id="timer-bar"></div>
    </div>
    <div class="buttons" id="buttons-container"></div>
</div>

<div id="pause-overlay" class="overlay" role="dialog" aria-label="Game paused">
    <div class="pause-title">Paused</div>
    <div class="pause-buttons">
        <button id="resume-btn" class="btn btn--primary">Resume</button>
        <button id="quit-from-pause-btn" class="btn btn--secondary">Go to Menu</button>
    </div>
</div>

<div id="level-up-overlay" class="overlay" role="dialog" aria-label="Level up">
    <div class="level-up-title" id="level-up-title">Level Up!</div>
    <div class="level-up-streak" id="level-up-streak"></div>
    <div class="level-up-message" id="level-up-message">You reached Level 2</div>
    <div id="level-up-phase-badge" class="phase-badge" style="display:none;"></div>
    <div class="level-up-phase" id="level-up-phase"></div>
    <div class="level-up-info" id="level-up-info"></div>
    <div class="level-up-time" id="level-up-time"></div>
    <div class="level-up-countdown" id="level-up-countdown">3</div>
    <div class="overlay-nav">
        <button class="btn btn--secondary" id="level-up-menu-btn">Go to Menu</button>
    </div>
</div>

<div id="cycle-complete-overlay" class="overlay" role="dialog" aria-label="Cycle complete">
    <div class="cycle-complete-title">Cycle Complete!</div>
    <div class="cycle-complete-message" id="cycle-complete-message">You finished Cycle 1!</div>
    <div class="cycle-complete-colors" id="cycle-complete-colors">New colours unlocked!</div>
    <div class="new-color-badges" id="new-color-badges"></div>
    <div class="cycle-complete-info">Time resets to 10 seconds</div>
    <div class="cycle-complete-countdown" id="cycle-complete-countdown">5</div>
    <div class="overlay-nav">
        <button class="btn btn--secondary" id="cycle-complete-menu-btn">Go to Menu</button>
    </div>
</div>

<div id="speed-mercy-overlay" class="overlay" role="dialog" aria-label="Speed mercy â€” choose what to do next">
    <div class="speed-mercy-title">Speed Round!</div>
    <div class="speed-mercy-message" id="speed-mercy-message">That 2-second timer is no joke!</div>
    <div class="speed-mercy-streak" id="speed-mercy-streak">Current streak: 0</div>
    <div class="speed-mercy-buttons">
        <button id="speed-mercy-retry" class="btn btn--primary">Try Again</button>
        <button id="speed-mercy-add-time">Add 2 Seconds</button>
        <button id="speed-mercy-end" class="btn btn--secondary">End Game</button>
    </div>
</div>


<div id="end-screen">
    <h1>Well Done!</h1>
    <div id="end-message"></div>
    <div id="final-score">0</div>
    <div class="prompt-label">correct answers</div>
    <div class="personal-best" id="personal-best">New Personal Best!</div>
    <div class="best-streak-display" id="best-streak-display"></div>
    <div class="stats-row">
        <div class="stat-item">
            <div class="stat-value" id="accuracy-stat">0%</div>
            <div class="stat-label">accuracy</div>
        </div>
        <div class="stat-item">
            <div class="stat-value" id="avg-time-stat">0.0s</div>
            <div class="stat-label">avg time</div>
        </div>
    </div>
    <br><br>
    <button id="restart-btn" class="btn btn--primary">Continue</button>
</div>

<script>
  window.SUPABASE_URL      = 'https://yqgrmpewmrmcajbdjaem.supabase.co';
  window.SUPABASE_ANON_KEY = 'sb_publishable_PQl5YT_ym_Z5XUgIquYfrA__Gvm7L29';
</script>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js');
  }
</script>
<script type="module" src="app.js"></script>

</body>
</html>
